<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
<title>Uncertain times: Code repository for publicly available finance data</title>

<meta property="description" itemprop="description" content="Repository of R functions and code to obtain publicly available financial data from various sources"/>

<link rel="canonical" href="https://www.christoph-jaeckel.com/posts/2023-12-30-code-repository-for-publicly-available-finance-data/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2023-12-30"/>
<meta property="article:created" itemprop="dateCreated" content="2023-12-30"/>
<meta name="article:author" content="Christoph Jäckel"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Uncertain times: Code repository for publicly available finance data"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="Repository of R functions and code to obtain publicly available financial data from various sources"/>
<meta property="og:url" content="https://www.christoph-jaeckel.com/posts/2023-12-30-code-repository-for-publicly-available-finance-data/"/>
<meta property="og:image" content="https://www.christoph-jaeckel.com/posts/2023-12-30-code-repository-for-publicly-available-finance-data/code-repository-for-publicly-available-finance-data_files/figure-html5/RunECBfunctions-1.png"/>
<meta property="og:image:width" content="1248"/>
<meta property="og:image:height" content="768"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Uncertain times"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="Uncertain times: Code repository for publicly available finance data"/>
<meta property="twitter:description" content="Repository of R functions and code to obtain publicly available financial data from various sources"/>
<meta property="twitter:url" content="https://www.christoph-jaeckel.com/posts/2023-12-30-code-repository-for-publicly-available-finance-data/"/>
<meta property="twitter:image" content="https://www.christoph-jaeckel.com/posts/2023-12-30-code-repository-for-publicly-available-finance-data/code-repository-for-publicly-available-finance-data_files/figure-html5/RunECBfunctions-1.png"/>
<meta property="twitter:image:width" content="1248"/>
<meta property="twitter:image:height" content="768"/>

<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","base_url","date","output","categories","draft","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["Code repository for publicly available finance data"]},{"type":"character","attributes":{},"value":["Repository of R functions and code to obtain publicly available financial data from various sources"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Christoph Jäckel"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":[]}},"value":[]}]}]},{"type":"character","attributes":{},"value":["https://github.com/christophj/cjaeckel.github.io/"]},{"type":"character","attributes":{},"value":["2023-12-30"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","code_folding","toc"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["Data"]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["https://www.christoph-jaeckel.com/posts/2023-12-30-code-repository-for-publicly-available-finance-data/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["10_Industry_Portfolios_Daily.csv","code-repository-for-publicly-available-finance-data_files/anchor-4.2.2/anchor.min.js","code-repository-for-publicly-available-finance-data_files/bowser-1.9.3/bowser.min.js","code-repository-for-publicly-available-finance-data_files/distill-2.2.21/template.v2.js","code-repository-for-publicly-available-finance-data_files/figure-html5/RunECBfunctions-1.png","code-repository-for-publicly-available-finance-data_files/header-attrs-2.18/header-attrs.js","code-repository-for-publicly-available-finance-data_files/jquery-3.6.0/jquery-3.6.0.js","code-repository-for-publicly-available-finance-data_files/jquery-3.6.0/jquery-3.6.0.min.js","code-repository-for-publicly-available-finance-data_files/jquery-3.6.0/jquery-3.6.0.min.map","code-repository-for-publicly-available-finance-data_files/popper-2.6.0/popper.min.js","code-repository-for-publicly-available-finance-data_files/tippy-6.2.7/tippy-bundle.umd.min.js","code-repository-for-publicly-available-finance-data_files/tippy-6.2.7/tippy-light-border.css","code-repository-for-publicly-available-finance-data_files/tippy-6.2.7/tippy.css","code-repository-for-publicly-available-finance-data_files/tippy-6.2.7/tippy.umd.min.js","code-repository-for-publicly-available-finance-data_files/webcomponents-2.0.0/webcomponents.js","eurofxref-hist.csv","F-F_Research_Data_Factors_daily.CSV"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.18/header-attrs.js"></script>
  <script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<script type="text/javascript" src="https://www.cookieconsent.com/releases/3.1.0/cookie-consent.js"></script>
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
'notice_banner_type':'simple',
'consent_type': 'express',
'palette': 'light',
'language': 'en',
'website_name': 'uncertain-times',
'cookies_policy_url': 'url',
'change_preferences_selector':'#CookiePreferences'
});});</script>
<script type="text/plain" cookie-consent="tracking" async src="https://www.googletagmanager.com/gtag/js?id=G-J5RM2E8REJ"></script>
<script type="text/plain" cookie-consent="tracking">
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-J5RM2E8REJ');
</script>
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Code repository for publicly available finance data","description":"Repository of R functions and code to obtain publicly available financial data from various sources","authors":[{"author":"Christoph Jäckel","authorURL":{},"affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2023-12-30T00:00:00.000+01:00","citationText":"Jäckel, 2023"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="../../index.html" class="title">Uncertain times</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../about.html">About</a>
<a href="../../index.xml">
<i class="fa fa-rss" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Code repository for publicly available finance data</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
  <a href="../../index.html#category:Data" class="dt-tag">Data</a>
</div>
<!--/radix_placeholder_categories-->
<p><p>Repository of R functions and code to obtain publicly available financial data from various sources</p></p>
</div>

<div class="d-byline">
  Christoph Jäckel true 
  
<br/>2023-12-30
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#damodarans-finance-data" id="toc-damodarans-finance-data">Damodaran’s finance data</a>
<ul>
<li><a href="#function" id="toc-function">Function</a></li>
<li><a href="#code-to-run-function" id="toc-code-to-run-function">Code to run function</a></li>
</ul></li>
<li><a href="#kenneth-french-stock-market-data" id="toc-kenneth-french-stock-market-data">Kenneth French’ stock market data</a>
<ul>
<li><a href="#functions" id="toc-functions">Functions</a></li>
<li><a href="#code-to-run-functions" id="toc-code-to-run-functions">Code to run functions</a></li>
</ul></li>
<li><a href="#ecb-fx-rates" id="toc-ecb-fx-rates">ECB FX rates</a>
<ul>
<li><a href="#functions-1" id="toc-functions-1">Functions</a></li>
<li><a href="#code-to-run-functions-1" id="toc-code-to-run-functions-1">Code to run functions</a></li>
</ul></li>
</ul>
</nav>
</div>
<p>This post includes functions and code that obtain financial data such as FX rates, stock returns, and valuation multiples. Each section is named after the data source. I might add new code over time to this post. I will not explain the code or study the data in much detail, this is really only meant to show how to get the data into R quickly.</p>
<h1 id="damodarans-finance-data">Damodaran’s finance data</h1>
<p>This code is simply copied from <a href="https://www.christoph-jaeckel.com/posts/2021-01-17-automatically-obtaining-data-from-damodarans-website-with-r/">this post</a>.</p>
<h2 id="function">Function</h2>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'>#' Wrapper to import data from Excel</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' This functions serves as a wrapper to easily import data from particular Excel files, for example</span></span>
<span><span class='co'>#' as provided by Damodaran on his website. These Excel files have a format in which information is</span></span>
<span><span class='co'>#' provided in the first couple of lines and then the actual data set starts.</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' Functions such as \code{\link{read_excel}} allow the user to explicitly tell the function which</span></span>
<span><span class='co'>#' rows to skip. While this is certainly a helpful feature, it becomes cumbersome for many similar</span></span>
<span><span class='co'>#' files but with different number of rows that can be skipped as the user would have to open each</span></span>
<span><span class='co'>#' file manually to come up with the parameters. This wrapper tries to do it automatically.</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @param .str_file string; file location.</span></span>
<span><span class='co'>#' @param .file_ext string; extension of the Excel-file. Default: ".xls", for which this function</span></span>
<span><span class='co'>#'                  is tested. So might not work with other Excel file extensions.</span></span>
<span><span class='co'>#' @param .perc_numeric numeric; the percentage above which you assume a column is of type numeric.</span></span>
<span><span class='co'>#'                      Background: in the function, you convert a column to numeric with \code{</span></span>
<span><span class='co'>#'                      as.numeric}; this will return NA if this function does not know how to</span></span>
<span><span class='co'>#'                      convert the value to numeric; hence, you can guess now that if there aren't</span></span>
<span><span class='co'>#'                      too many NAs from this function, the column is actually a numeric one.</span></span>
<span><span class='co'>#'                      The default is 0.15, which means that a column is considered numeric if</span></span>
<span><span class='co'>#'                      at least 15 per cent of the values can be converted.</span></span>
<span><span class='co'>#' @param .bol_option_1 boolean; if TRUE, the header position is determined by looking at the starting</span></span>
<span><span class='co'>#'                      point of non-NA values after conversion to non-numeric that occurs most often.</span></span>
<span><span class='co'>#'                      if FALSE, you use the first row that has all observations (which is most likely</span></span>
<span><span class='co'>#'                      the header).</span></span>
<span><span class='co'>#' @return data.table from reading the Excel file with the start row determined by this wrapper.</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @importFrom readxl read_excel</span></span>
<span><span class='co'>#' @importFrom httr GET write_disk</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @export</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @references</span></span>
<span><span class='co'>#' \url{https://stackoverflow.com/questions/41368628/read-excel-file-from-a-url-using-the-readxl-package}</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @examples</span></span>
<span><span class='co'>#' \dontrun{</span></span>
<span><span class='co'>#' str_file &lt;- "http://pages.stern.nyu.edu/~adamodar/pc/archives/vebitda18.xls"</span></span>
<span><span class='co'>#' import_from_excel(str_file)</span></span>
<span><span class='co'>#' }</span></span>
<span><span class='va'>import_from_excel</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>.str_file</span>, <span class='va'>.file_ext</span> <span class='op'>=</span> <span class='st'>".xls"</span>, <span class='va'>.perc_numeric</span><span class='op'>=</span><span class='fl'>0.15</span>,</span>
<span>                              <span class='va'>.bol_option_1</span><span class='op'>=</span><span class='cn'>TRUE</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span></span>
<span></span>
<span>  <span class='co'>#### Save URL file locally with GET</span></span>
<span>  <span class='fu'>httr</span><span class='fu'>::</span><span class='fu'><a href='https://httr.r-lib.org/reference/GET.html'>GET</a></span><span class='op'>(</span><span class='va'>.str_file</span>, <span class='fu'>write_disk</span><span class='op'>(</span><span class='va'>tf</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempfile</a></span><span class='op'>(</span>fileext <span class='op'>=</span> <span class='st'>".xls"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span>  <span class='co'>####Save the file into a data.table</span></span>
<span>  <span class='va'>intDT</span> <span class='op'>&lt;-</span> <span class='fu'>as.data.table</span><span class='op'>(</span><span class='fu'>readxl</span><span class='fu'>::</span><span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span><span class='op'>(</span><span class='va'>tf</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span>  <span class='co'>####Determine first row by two ways</span></span>
<span></span>
<span>  <span class='co'>## 1. It's likely that most columns in the data set are numeric; hence, you will convert</span></span>
<span>  <span class='co'>#     each column to a numeric and save the first non-NA number; the row where this happens</span></span>
<span>  <span class='co'>#     most often (essentially the median) is your best guess for the first data row (i.e.</span></span>
<span>  <span class='co'>#     one below the header)</span></span>
<span>  <span class='va'>i</span> <span class='op'>&lt;-</span> <span class='fl'>1</span></span>
<span>  <span class='va'>vec_first_number</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>intDT</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='va'>col_types</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"guess"</span>, times<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>intDT</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>col</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>intDT</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span></span>
<span>    <span class='va'>vec</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/warning.html'>suppressWarnings</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/unlist.html'>unlist</a></span><span class='op'>(</span><span class='va'>intDT</span><span class='op'>[</span>,<span class='va'>col</span>, with<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='va'>vec_first_number</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/warning.html'>suppressWarnings</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>vec</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='co'>#In case there is no numeric data in there, your best  guess is that the data set starts</span></span>
<span>    <span class='co'>#at the second line (after headers)</span></span>
<span>    <span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/is.finite.html'>is.finite</a></span><span class='op'>(</span><span class='va'>vec_first_number</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>      <span class='va'>vec_first_number</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>2</span></span>
<span>    <span class='op'>}</span></span>
<span>    <span class='co'># Also save if you believe that the column in a numeric one, as you can read the column as</span></span>
<span>    <span class='co'># numeric later</span></span>
<span>    <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>vec</span><span class='op'>)</span><span class='op'>)</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>vec</span><span class='op'>)</span><span class='op'>&gt;</span><span class='va'>.perc_numeric</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>      <span class='va'>col_types</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='st'>"numeric"</span></span>
<span>    <span class='op'>}</span></span>
<span>    <span class='va'>i</span> <span class='op'>&lt;-</span> <span class='va'>i</span> <span class='op'>+</span> <span class='fl'>1</span></span>
<span>  <span class='op'>}</span></span>
<span>  <span class='va'>pos_header1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>vec_first_number</span>, na.rm<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>1</span></span>
<span></span>
<span>  <span class='co'>## 2. If the first few rows do not belong yet to the actual data set, you would expect more NAs</span></span>
<span>  <span class='co'>#     there than in the data set thereafter. In particular in case of a data set with headers,</span></span>
<span>  <span class='co'>#     with you kinda require here, you must expect that the row with the headers doesn't have</span></span>
<span>  <span class='co'>#     any NAs; hence, simply use the first occurrence of a row with no NAs as the decision</span></span>
<span>  <span class='co'>#     criterium</span></span>
<span>  <span class='co'>#     Of course, this can fail if one of the information rows is filled up or if there is</span></span>
<span>  <span class='co'>#     no header row or even the header includes NAs.</span></span>
<span></span>
<span>  <span class='co'># Get NAs per row</span></span>
<span>  <span class='co'># https://stackoverflow.com/questions/35306500/r-data-table-count-na-per-row</span></span>
<span>  <span class='va'>intDT</span><span class='op'>[</span>, <span class='va'>num_obs</span> <span class='op'>:=</span> <span class='fu'><a href='https://rdrr.io/r/base/funprog.html'>Reduce</a></span><span class='op'>(</span><span class='va'>`+`</span>, <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>.SD</span>,<span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>]</span></span>
<span>  <span class='va'>pos_header2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/warning.html'>suppressWarnings</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>intDT</span><span class='op'>$</span><span class='va'>num_obs</span><span class='op'>==</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>intDT</span><span class='op'>$</span><span class='va'>num_obs</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/is.finite.html'>is.finite</a></span><span class='op'>(</span><span class='va'>pos_header2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='va'>pos_header2</span> <span class='op'>&lt;-</span> <span class='fl'>1</span></span>
<span>  <span class='op'>}</span></span>
<span>  <span class='va'>intDT</span><span class='op'>[</span>, <span class='va'>num_obs</span><span class='op'>:=</span><span class='cn'>NULL</span><span class='op'>]</span></span>
<span></span>
<span>  <span class='kw'>if</span> <span class='op'>(</span><span class='va'>pos_header2</span><span class='op'>==</span><span class='va'>pos_header2</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"Success: Both approaches in import_from_excel guessed the same start row of the data set.\n"</span><span class='op'>)</span></span>
<span>    <span class='va'>pos_header</span> <span class='op'>&lt;-</span> <span class='va'>pos_header1</span></span>
<span>  <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>.bol_option_1</span>, <span class='va'>pos_header</span> <span class='op'>&lt;-</span> <span class='va'>pos_header1</span>, <span class='va'>pos_header</span> <span class='op'>&lt;-</span> <span class='va'>pos_header2</span><span class='op'>)</span></span>
<span>  <span class='op'>}</span></span>
<span></span>
<span>  <span class='co'>#Download data again, now with skip filled in and check then number of columns; trim col_types</span></span>
<span>  <span class='co'>#This has to be done as otherwise it can happen that the last column doesn't exist anymore</span></span>
<span>  <span class='co'>#because it was only read before due to a line that is now excluded.</span></span>
<span>  <span class='co'>#See http://pages.stern.nyu.edu/~adamodar/pc/archives/fundgrEB14.xls as an example</span></span>
<span>  <span class='va'>intDT</span> <span class='op'>&lt;-</span> <span class='fu'>as.data.table</span><span class='op'>(</span><span class='fu'>readxl</span><span class='fu'>::</span><span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span><span class='op'>(</span><span class='va'>tf</span>, skip<span class='op'>=</span><span class='va'>pos_header</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>intDT</span><span class='op'>)</span><span class='op'>&lt;</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>col_types</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='va'>col_types</span> <span class='op'>&lt;-</span> <span class='va'>col_types</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>intDT</span><span class='op'>)</span><span class='op'>]</span></span>
<span>  <span class='op'>}</span></span>
<span></span>
<span>  <span class='va'>intDT</span> <span class='op'>&lt;-</span> <span class='fu'>as.data.table</span><span class='op'>(</span><span class='fu'>readxl</span><span class='fu'>::</span><span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span><span class='op'>(</span><span class='va'>tf</span>,</span>
<span>                                    skip<span class='op'>=</span><span class='va'>pos_header</span>,</span>
<span>                                    col_names <span class='op'>=</span> <span class='cn'>TRUE</span>,</span>
<span>                                    col_types <span class='op'>=</span> <span class='va'>col_types</span>,</span>
<span>                                    <span class='va'>...</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/unlink.html'>unlink</a></span><span class='op'>(</span><span class='va'>tf</span><span class='op'>)</span> <span class='co'>#Clean up the temporary file</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>intDT</span><span class='op'>)</span></span>
<span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
</details>
</div>
<h2 id="code-to-run-function">Code to run function</h2>
<p>As <code>str_file</code>, you have to pass a link to a file that is saved on Damodaran’s website. You can find the overview <a href="https://pages.stern.nyu.edu/~adamodar/pc/archives/">here</a>. For example, to download the EV/EBITDA multiples of 2018, run the following code.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://readxl.tidyverse.org'>readxl</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://httr.r-lib.org/'>httr</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://r-datatable.com'>data.table</a></span><span class='op'>)</span></span>
<span><span class='va'>str_file</span> <span class='op'>&lt;-</span> <span class='st'>"http://pages.stern.nyu.edu/~adamodar/pc/archives/vebitda18.xls"</span></span>
<span><span class='va'>dtEBITDA2018</span> <span class='op'>&lt;-</span> <span class='fu'>import_from_excel</span><span class='op'>(</span><span class='va'>str_file</span><span class='op'>)</span></span></code></pre>
</div>
</details>
</div>
<p>It is easy to wrap around a for loop and combine this data over time.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'>### Download Tax Rates</span></span>
<span><span class='va'>taxRatesDT</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span><span class='va'>str_path</span> <span class='op'>&lt;-</span> <span class='st'>"http://pages.stern.nyu.edu/~adamodar/pc/archives/"</span> </span>
<span><span class='kw'>for</span> <span class='op'>(</span><span class='va'>year</span> <span class='kw'>in</span> <span class='fl'>2014</span><span class='op'>:</span><span class='fl'>2022</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  </span>
<span>  <span class='va'>str_file</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>str_path</span>, <span class='st'>"countrytaxrates"</span>, <span class='fu'><a href='https://rdrr.io/r/base/substr.html'>substr</a></span><span class='op'>(</span><span class='va'>year</span>,star<span class='op'>=</span><span class='fl'>3</span>,stop<span class='op'>=</span><span class='fl'>4</span><span class='op'>)</span>, <span class='st'>".xls"</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='va'>intDT</span> <span class='op'>&lt;-</span> <span class='fu'>import_from_excel</span><span class='op'>(</span>.str_file<span class='op'>=</span><span class='va'>str_file</span>,</span>
<span>                             na <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"NA"</span>, <span class='st'>"N/A"</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='va'>intDT</span><span class='op'>[</span>, <span class='va'>Year</span><span class='op'>:=</span><span class='va'>year</span><span class='op'>]</span></span>
<span>  <span class='va'>taxRatesDT</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span><span class='op'>(</span><span class='va'>taxRatesDT</span>, <span class='va'>intDT</span>, fill<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span></span>
<span>                          </span>
<span><span class='op'>}</span> </span></code></pre>
</div>
</details>
</div>
<p>Given the sheer size of Damodaran’s archive, it is not surprising that some inconsistencies or changes happen over time that make it difficult to fully automate it to obtain the data. In this particular case, as of December 2023, you will notice that column country was labelled “Location” until 2014 and from 2015 “Country”. Hence, you have to combine the columns. It also turns out that Damodaran changed the format for this particular data set and includes historical tax rates in newer data sets. You therefore end up with several rows for one country. To fix this, I create a new data set with only one line per country, averaging over all non-NA tax rates per year (they should all be the same anyways as they are duplicates).</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'>### Combine columns Location and Country</span></span>
<span><span class='va'>taxRatesDT</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>Country</span><span class='op'>)</span>, <span class='va'>Country</span><span class='op'>:=</span><span class='va'>Location</span><span class='op'>]</span></span>
<span><span class='va'>taxRatesDT</span><span class='op'>[</span>, <span class='va'>Location</span><span class='op'>:=</span><span class='cn'>NULL</span><span class='op'>]</span></span>
<span><span class='co'>### Aggregate multiple rows per country</span></span>
<span><span class='va'>taxRatesDT</span><span class='op'>[</span>,<span class='va'>Year</span><span class='op'>:=</span><span class='cn'>NULL</span><span class='op'>]</span></span>
<span><span class='va'>aggTaxRatesDT</span> <span class='op'>&lt;-</span> <span class='va'>taxRatesDT</span><span class='op'>[</span>,  <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>.SD</span>, <span class='va'>mean</span>, na.rm<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>, by<span class='op'>=</span><span class='va'>Country</span><span class='op'>]</span></span>
<span><span class='va'>aggTaxRatesDT</span><span class='op'>[</span><span class='va'>Country</span><span class='op'>==</span><span class='st'>"Germany"</span><span class='op'>]</span></span></code></pre>
</div>
</details>
<pre><code>   Country   2006   2007   2008   2009   2010   2011   2012   2013
1: Germany 0.3834 0.3836 0.2951 0.2944 0.2941 0.2937 0.2948 0.2955
     2014      2015   2016   2003   2004   2005   2017 2018 2019 2020
1: 0.2958 0.2969667 0.2972 0.3958 0.3829 0.3831 0.2979  0.3  0.3  0.3
   2021 2022 2023E
1:  0.3  0.3   0.3</code></pre>
</div>
<h1 id="kenneth-french-stock-market-data">Kenneth French’ stock market data</h1>
<p>I used this function already for example in the post on <a href="https://www.christoph-jaeckel.com/posts/2022-03-27-sector-performance/">sector performance</a> to obtain data from Kenneth French’s website.</p>
<h2 id="functions">Functions</h2>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'>#' Wrapper to import data in CSV format within a zip-folder</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' This functions serves as a wrapper to easily import data from particular ZIP files that hold</span></span>
<span><span class='co'>#' CSV files, for example as provided by Kenneth French on his website. The user has to provide</span></span>
<span><span class='co'>#' the location of the files (can be a URL) and how many lines should be skipped.</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' The numbers of line skipped can be passed with the \code{skip} argument in function</span></span>
<span><span class='co'>#' \code{fread} from the \code{data.table} package. See \code{?fread} for more information.</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @inheritParams import_from_excel</span></span>
<span><span class='co'>#' @param .file_ext string; extension of the Excel-file. Default: ".xls", for which this function</span></span>
<span><span class='co'>#'                  is tested. So might not work with other Excel file extensions.</span></span>
<span><span class='co'>#' @return data.table from reading the CSV file with the start row determined by this wrapper.</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @importFrom data.table fread</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @export</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @references</span></span>
<span><span class='co'>#' \url{https://stackoverflow.com/questions/3053833/using-r-to-download-zipped-data-file-extract-and-import-data}</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @examples</span></span>
<span><span class='co'>#' \dontrun{</span></span>
<span><span class='co'>#' ### Download factors</span></span>
<span><span class='co'>#' str_file &lt;- "http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/ftp/F-F_Research_Data_Factors_daily_CSV.zip"</span></span>
<span><span class='co'>#' import_from_CSV_in_zip(str_file, skip = 3)</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' ### Download industry performances</span></span>
<span><span class='co'>#' str_file &lt;- "https://mba.tuck.dartmouth.edu/pages/faculty/ken.french/ftp/10_Industry_Portfolios_daily_CSV.zip"</span></span>
<span><span class='co'>#' import_from_CSV_in_zip(str_file, skip = 9, header=TRUE)</span></span>
<span><span class='co'>#' }</span></span>
<span><span class='va'>import_from_CSV_in_zip</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>.str_file</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span></span>
<span></span>
<span>  <span class='va'>temp</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempfile</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/utils/download.file.html'>download.file</a></span><span class='op'>(</span><span class='va'>.str_file</span>,<span class='va'>temp</span>, mode<span class='op'>=</span><span class='st'>"wb"</span><span class='op'>)</span></span>
<span>  <span class='va'>csvDT</span> <span class='op'>&lt;-</span> <span class='fu'>data.table</span><span class='fu'>::</span><span class='fu'><a href='https://rdatatable.gitlab.io/data.table/reference/fread.html'>fread</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/utils/unzip.html'>unzip</a></span><span class='op'>(</span><span class='va'>temp</span><span class='op'>)</span>, <span class='va'>...</span><span class='op'>)</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/unlink.html'>unlink</a></span><span class='op'>(</span><span class='va'>temp</span><span class='op'>)</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>csvDT</span><span class='op'>)</span></span>
<span></span>
<span><span class='op'>}</span></span>
<span></span>
<span></span>
<span><span class='co'>#' Function to get data from Kenneth French's website and format it</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @inheritParams import_from_CSV_in_zip</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @return TODO</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @importFrom lubridate ymd</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @export</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @references</span></span>
<span><span class='co'>#' \url{https://mba.tuck.dartmouth.edu/pages/faculty/ken.french/data_library.html}</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @examples</span></span>
<span><span class='co'>#' \dontrun{</span></span>
<span><span class='co'>#' str_file &lt;- "http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/ftp/F-F_Research_Data_Factors_daily_CSV.zip"</span></span>
<span><span class='co'>#' get_FF_data(str_file, skip = 3)</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' ### Download industry performances</span></span>
<span><span class='co'>#' str_file &lt;- "https://mba.tuck.dartmouth.edu/pages/faculty/ken.french/ftp/10_Industry_Portfolios_daily_CSV.zip"</span></span>
<span><span class='co'>#' DT &lt;- get_FF_data(str_file, skip = 9, header=TRUE)</span></span>
<span><span class='co'>#' # Convert columns to numeric</span></span>
<span><span class='co'>#' cols &lt;- names(DT)[2:ncol(DT)]</span></span>
<span><span class='co'>#' DT[ , (cols) := lapply(.SD, as.numeric), .SDcols = cols]</span></span>
<span><span class='co'>#' # Calculate the mean daily return (in bps) over the last years</span></span>
<span><span class='co'>#' require(lubridate)</span></span>
<span><span class='co'>#' DT[year(Date)&gt;2010, lapply(.SD, mean), by = year(Date),.SDcols = cols]</span></span>
<span><span class='co'>#' DT[year(Date)&gt;2010, lapply(.SD, mean), .SDcols = cols]</span></span>
<span><span class='co'>#' }</span></span>
<span><span class='va'>get_FF_data</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>.str_file</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span></span>
<span></span>
<span>  <span class='co'>###1. Use import_from_CSV_in_zip to get data</span></span>
<span>  <span class='va'>csvDT</span> <span class='op'>&lt;-</span> <span class='fu'>import_from_CSV_in_zip</span><span class='op'>(</span><span class='va'>.str_file</span>, <span class='va'>...</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span>  <span class='co'>###2. Change names of columns</span></span>
<span>  <span class='co'>#     FF doesn't label the date column, enter</span></span>
<span>  <span class='fu'>data.table</span><span class='fu'>::</span><span class='fu'><a href='https://rdatatable.gitlab.io/data.table/reference/setattr.html'>setnames</a></span><span class='op'>(</span><span class='va'>csvDT</span>,</span>
<span>           old <span class='op'>=</span> <span class='st'>"V1"</span>,</span>
<span>           new <span class='op'>=</span> <span class='st'>"Date"</span><span class='op'>)</span></span>
<span>  <span class='co'>#     Get rid of hyphens, don't ge well with column names</span></span>
<span>  <span class='fu'>data.table</span><span class='fu'>::</span><span class='fu'><a href='https://rdatatable.gitlab.io/data.table/reference/setattr.html'>setnames</a></span><span class='op'>(</span><span class='va'>csvDT</span>,</span>
<span>           old <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span><span class='op'>(</span><span class='st'>"-"</span>,<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>csvDT</span><span class='op'>)</span>,value<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>           new <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>"-"</span>, <span class='st'>""</span>, <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span><span class='op'>(</span><span class='st'>"-"</span>,<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>csvDT</span><span class='op'>)</span>,value<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span>  <span class='co'>###3. Convert Date column to date; through warning if format changed</span></span>
<span>  <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='fu'>lubridate</span><span class='fu'>::</span><span class='fu'><a href='https://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='va'>csvDT</span><span class='op'>$</span><span class='va'>Date</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>&gt;</span><span class='fl'>0</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='kw'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span><span class='op'>(</span><span class='st'>"Error in parsing dates to date format: it seems the format in Kenneth French files has changed."</span><span class='op'>)</span></span>
<span>  <span class='op'>}</span></span>
<span>  <span class='va'>csvDT</span><span class='op'>[</span>, <span class='va'>Date</span><span class='op'>:=</span><span class='fu'>lubridate</span><span class='fu'>::</span><span class='fu'><a href='https://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='va'>Date</span><span class='op'>)</span><span class='op'>]</span></span>
<span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>csvDT</span><span class='op'>)</span></span>
<span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
</details>
</div>
<h2 id="code-to-run-functions">Code to run functions</h2>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'>### Download daily factors</span></span>
<span><span class='va'>str_file</span> <span class='op'>&lt;-</span> <span class='st'>"http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/ftp/F-F_Research_Data_Factors_daily_CSV.zip"</span></span>
<span><span class='va'>dailyFactors_DT</span> <span class='op'>&lt;-</span> <span class='fu'>get_FF_data</span><span class='op'>(</span><span class='va'>str_file</span>, skip <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span></span>
<span><span class='co'>### Download industry performances</span></span>
<span><span class='va'>str_file</span> <span class='op'>&lt;-</span> <span class='st'>"https://mba.tuck.dartmouth.edu/pages/faculty/ken.french/ftp/10_Industry_Portfolios_daily_CSV.zip"</span></span>
<span><span class='va'>DT</span> <span class='op'>&lt;-</span> <span class='fu'>get_FF_data</span><span class='op'>(</span><span class='va'>str_file</span>, skip <span class='op'>=</span> <span class='fl'>9</span>, header<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span></span>
<span><span class='co'># Convert columns to numeric</span></span>
<span><span class='va'>cols</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>DT</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>DT</span><span class='op'>)</span><span class='op'>]</span></span>
<span><span class='va'>DT</span><span class='op'>[</span> , <span class='op'>(</span><span class='va'>cols</span><span class='op'>)</span> <span class='op'>:=</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>.SD</span>, <span class='va'>as.numeric</span><span class='op'>)</span>, .SDcols <span class='op'>=</span> <span class='va'>cols</span><span class='op'>]</span></span>
<span><span class='co'># Calculate the mean daily return (in bps) over the last years</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='https://lubridate.tidyverse.org'>lubridate</a></span><span class='op'>)</span></span>
<span><span class='co'>#DT[year(Date)&gt;2010, lapply(.SD, mean), by = year(Date),.SDcols = cols]</span></span>
<span><span class='va'>DT</span><span class='op'>[</span><span class='fu'><a href='https://lubridate.tidyverse.org/reference/year.html'>year</a></span><span class='op'>(</span><span class='va'>Date</span><span class='op'>)</span><span class='op'>&gt;</span><span class='fl'>2010</span>, <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>.SD</span>, <span class='va'>mean</span><span class='op'>)</span>, .SDcols <span class='op'>=</span> <span class='va'>cols</span><span class='op'>]</span></span></code></pre>
</div>
</details>
<pre><code>        NoDur      Durbl      Manuf      Enrgy      HiTec      Telcm
1: 0.03969231 0.06825231 0.04592923 0.03685538 0.07185846 0.03554769
        Shops       Hlth      Utils      Other
1: 0.05878154 0.05327692 0.03922154 0.05052308</code></pre>
</div>
<h1 id="ecb-fx-rates">ECB FX rates</h1>
<p>The ECB posts daily FX rates between the EUR and other currencies.</p>
<h2 id="functions-1">Functions</h2>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'>#' Import FX rates from the ECB website</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' This functions downloads the FX rates directly from the ECB website and returns them</span></span>
<span><span class='co'>#' in long format. It also makes sure that there are no missing dates; in case a date is</span></span>
<span><span class='co'>#' missing in the ECB data set, it is filled with the previous value (see reference</span></span>
<span><span class='co'>#' to the Stackoverflow link on how this is done).</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' All FX rates are in relation to the euro.</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' It relies on \code{\link{import_from_CSV_in_zip}} to download the data, which is provided</span></span>
<span><span class='co'>#' as a CSV file in a zip folder.</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @inheritParams import_from_CSV_in_zip</span></span>
<span><span class='co'>#' @return data.table in long format including the FX rates as provided by the ECB bank on their</span></span>
<span><span class='co'>#'         website. data.table has three columns: "Date", "CUR" (3-digit identifier of the currency),</span></span>
<span><span class='co'>#'         "FXrate" (actual FX rate value).</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @export</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @references</span></span>
<span><span class='co'>#' \url{https://stackoverflow.com/questions/22956803/fastest-way-for-filling-in-missing-dates-for-data-table}</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @examples</span></span>
<span><span class='co'>#' \dontrun{</span></span>
<span><span class='co'>#' require(data.table)</span></span>
<span><span class='co'>#' str_file &lt;- "https://www.ecb.europa.eu/stats/eurofxref/eurofxref-hist.zip?c39d518d60048add50a3cccd64e06146"</span></span>
<span><span class='co'>#' DT &lt;- import_ECB_FX_rates(str_file)</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' ### Which currencies (CUR) are covered</span></span>
<span><span class='co'>#' unique(DT$CUR)</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' ### Plot for example CHF/EUR over time</span></span>
<span><span class='co'>#' require(ggplot2)</span></span>
<span><span class='co'>#' ggplot(DT[CUR=="CHF"], aes(x=Date, y=FXrate)) + geom_line()</span></span>
<span><span class='co'>#' }</span></span>
<span><span class='va'>import_ECB_FX_rates</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>.str_file</span><span class='op'>)</span> <span class='op'>{</span></span>
<span></span>
<span>  <span class='co'>### Import CSV  File</span></span>
<span>  <span class='va'>DT</span> <span class='op'>&lt;-</span> <span class='fu'>import_from_CSV_in_zip</span><span class='op'>(</span><span class='va'>.str_file</span><span class='op'>)</span></span>
<span></span>
<span>  <span class='co'>### Convert dates to date-format</span></span>
<span>  <span class='va'>DT</span><span class='op'>[</span>, <span class='va'>Date</span><span class='op'>:=</span><span class='fu'><a href='https://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='va'>Date</span><span class='op'>)</span><span class='op'>]</span></span>
<span></span>
<span>  <span class='co'>### Bring into long format</span></span>
<span>  <span class='va'>DT</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/warning.html'>suppressWarnings</a></span><span class='op'>(</span><span class='fu'><a href='https://rdatatable.gitlab.io/data.table/reference/melt.data.table.html'>melt</a></span><span class='op'>(</span><span class='va'>DT</span>, id.var<span class='op'>=</span><span class='st'>"Date"</span>,</span>
<span>             variable.name <span class='op'>=</span> <span class='st'>"CUR"</span>,</span>
<span>             variable.factor <span class='op'>=</span> <span class='cn'>FALSE</span>, <span class='co'>#Keep as character</span></span>
<span>             value.name    <span class='op'>=</span> <span class='st'>"FXrate"</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span>  <span class='va'>DT</span><span class='op'>[</span>, <span class='va'>FXrate</span><span class='op'>:=</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>FXrate</span><span class='op'>)</span><span class='op'>]</span></span>
<span></span>
<span>  <span class='co'>###  Get rid of missing values</span></span>
<span>  <span class='va'>DT</span> <span class='op'>&lt;-</span> <span class='va'>DT</span><span class='op'>[</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>FXrate</span><span class='op'>)</span><span class='op'>]</span></span>
<span></span>
<span>  <span class='co'>###Fill in missing dates with previous value</span></span>
<span>  <span class='co'>#https://stackoverflow.com/questions/22956803/fastest-way-for-filling-in-missing-dates-for-data-table</span></span>
<span>  <span class='fu'><a href='https://rdatatable.gitlab.io/data.table/reference/setkey.html'>setkey</a></span><span class='op'>(</span><span class='va'>DT</span>, <span class='va'>Date</span><span class='op'>)</span></span>
<span>  <span class='va'>indx</span> <span class='op'>&lt;-</span> <span class='va'>DT</span><span class='op'>[</span>,<span class='fu'>.</span><span class='op'>(</span>Date<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>Date</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>Date</span><span class='op'>)</span>,<span class='st'>"days"</span><span class='op'>)</span><span class='op'>)</span>,<span class='va'>CUR</span><span class='op'>]</span></span>
<span></span>
<span>  <span class='co'># key the tables and join them using a rolling join</span></span>
<span>  <span class='fu'><a href='https://rdatatable.gitlab.io/data.table/reference/setkey.html'>setkey</a></span><span class='op'>(</span><span class='va'>DT</span>,<span class='va'>CUR</span>,<span class='va'>Date</span><span class='op'>)</span></span>
<span>  <span class='fu'><a href='https://rdatatable.gitlab.io/data.table/reference/setkey.html'>setkey</a></span><span class='op'>(</span><span class='va'>indx</span>,<span class='va'>CUR</span>,<span class='va'>Date</span><span class='op'>)</span></span>
<span>  <span class='va'>DT</span> <span class='op'>&lt;-</span> <span class='va'>DT</span><span class='op'>[</span><span class='va'>indx</span>,roll<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>]</span></span>
<span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>DT</span><span class='op'>)</span></span>
<span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='co'>#' Get FX pair from ECB data</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' Starting with the data.table returned by \code{\link{import_ECB_FX_rates}}, this function</span></span>
<span><span class='co'>#' returns the FX rate between two currencies. \code{.CUR_base} is the basis of the FX rate.</span></span>
<span><span class='co'>#' For example, \code{.CUR_base="EUR"} and \code{.CUR=="USD"} is the equivalent of "USD/EUR".</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @param .dt data.table as returned by \code{\link{import_ECB_FX_rates}}</span></span>
<span><span class='co'>#' @param .start_date Start date for which the FX rate should be shown; Default: NA, i.e.</span></span>
<span><span class='co'>#'         as far back as possible.</span></span>
<span><span class='co'>#' @param .end_date End date for which the FX rate should be shown; Default: NA, i.e.</span></span>
<span><span class='co'>#'        as current as possible.</span></span>
<span><span class='co'>#' @param .CUR 3-digit currency identifier; think ".CUR_base/.CUR"</span></span>
<span><span class='co'>#' @param .CUR_base 3-digit currency identifier; think ".CUR_base/.CUR"</span></span>
<span><span class='co'>#' @return data.table with three columns: "Date", "FX", "FXrate"</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @export</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' @examples</span></span>
<span><span class='co'>#' \dontrun{</span></span>
<span><span class='co'>#' require(data.table)</span></span>
<span><span class='co'>#' require(lubridate)</span></span>
<span><span class='co'>#' str_file &lt;- "https://www.ecb.europa.eu/stats/eurofxref/eurofxref-hist.zip?c39d518d60048add50a3cccd64e06146"</span></span>
<span><span class='co'>#' DT &lt;- import_ECB_FX_rates(str_file)</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' dt &lt;- get_FX_pair_from_ECB_rates(.dt = DT,</span></span>
<span><span class='co'>#'                                  .start_date= dmy("31122020"),</span></span>
<span><span class='co'>#'                                  .end_date  = dmy("31122021"),</span></span>
<span><span class='co'>#'                                  .CUR_base="EUR", .CUR="CHF")</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' dt &lt;- get_FX_pair_from_ECB_rates(.dt = DT,</span></span>
<span><span class='co'>#'                                  .CUR_base="USD", .CUR="CAD")</span></span>
<span><span class='co'>#'</span></span>
<span><span class='co'>#' }</span></span>
<span><span class='va'>get_FX_pair_from_ECB_rates</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>.dt</span>, <span class='va'>.start_date</span><span class='op'>=</span><span class='cn'>NA</span>, <span class='va'>.end_date</span><span class='op'>=</span><span class='cn'>NA</span>, <span class='va'>.CUR_base</span>, <span class='va'>.CUR</span><span class='op'>)</span> <span class='op'>{</span></span>
<span></span>
<span>  <span class='co'>### Make a copy, you don't want to change the input .dt</span></span>
<span>  <span class='co'>#https://stackoverflow.com/questions/10225098/understanding-exactly-when-a-data-table-is-a-reference-to-vs-a-copy-of-another</span></span>
<span>  <span class='va'>intDT</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdatatable.gitlab.io/data.table/reference/copy.html'>copy</a></span><span class='op'>(</span><span class='va'>.dt</span><span class='op'>)</span></span>
<span></span>
<span>  <span class='co'>### Check currencies are in the table</span></span>
<span>  <span class='kw'>if</span> <span class='op'>(</span><span class='va'>.CUR_base</span><span class='op'>==</span><span class='st'>"EUR"</span> <span class='op'>|</span> <span class='va'>.CUR</span><span class='op'>==</span><span class='st'>"EUR"</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>.CUR_base</span>, <span class='va'>.CUR</span><span class='op'>)</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>intDT</span><span class='op'>$</span><span class='va'>CUR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>      <span class='kw'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span><span class='op'>(</span><span class='st'>"At least one currency is not in the ECB table."</span><span class='op'>)</span></span>
<span>    <span class='op'>}</span></span>
<span>  <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span></span>
<span>    <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>.CUR_base</span>, <span class='va'>.CUR</span><span class='op'>)</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>intDT</span><span class='op'>$</span><span class='va'>CUR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>&lt;</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>      <span class='kw'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span><span class='op'>(</span><span class='st'>"At least one currency is not in the ECB table."</span><span class='op'>)</span></span>
<span>    <span class='op'>}</span></span>
<span>  <span class='op'>}</span></span>
<span></span>
<span>  <span class='co'>### Limit data.table from .start_date to .end_date</span></span>
<span>  <span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>.start_date</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='va'>intDT</span> <span class='op'>&lt;-</span> <span class='va'>intDT</span><span class='op'>[</span><span class='va'>Date</span><span class='op'>&gt;=</span><span class='va'>.start_date</span><span class='op'>]</span></span>
<span>  <span class='op'>}</span></span>
<span>  <span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>.end_date</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='va'>intDT</span> <span class='op'>&lt;-</span> <span class='va'>intDT</span><span class='op'>[</span><span class='va'>Date</span><span class='op'>&gt;=</span><span class='va'>.end_date</span><span class='op'>]</span></span>
<span>  <span class='op'>}</span></span>
<span></span>
<span>  <span class='co'>### Change names</span></span>
<span>  <span class='fu'><a href='https://rdatatable.gitlab.io/data.table/reference/setattr.html'>setnames</a></span><span class='op'>(</span><span class='va'>intDT</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CUR"</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"FX"</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span>  <span class='co'>### Check if one currency is EUR ==&gt; just update FX value and return (potentially inversed)</span></span>
<span>  <span class='kw'>if</span> <span class='op'>(</span><span class='va'>.CUR_base</span><span class='op'>==</span><span class='st'>"EUR"</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='va'>intDT</span> <span class='op'>&lt;-</span> <span class='va'>intDT</span><span class='op'>[</span><span class='va'>FX</span><span class='op'>==</span><span class='va'>.CUR</span><span class='op'>]</span></span>
<span>    <span class='va'>intDT</span><span class='op'>[</span>, <span class='va'>FX</span><span class='op'>:=</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>.CUR</span>, <span class='st'>"/"</span>, <span class='st'>"EUR"</span><span class='op'>)</span><span class='op'>]</span></span>
<span>    <span class='va'>intDT</span><span class='op'>[</span>, <span class='va'>FXrate</span><span class='op'>:=</span><span class='fl'>1</span><span class='op'>/</span><span class='va'>FXrate</span><span class='op'>]</span></span>
<span>    <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>intDT</span><span class='op'>)</span></span>
<span>  <span class='op'>}</span></span>
<span>  <span class='kw'>if</span> <span class='op'>(</span><span class='va'>.CUR</span><span class='op'>==</span><span class='st'>"EUR"</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='va'>intDT</span> <span class='op'>&lt;-</span> <span class='va'>intDT</span><span class='op'>[</span><span class='va'>FX</span><span class='op'>==</span><span class='va'>.CUR_base</span><span class='op'>]</span></span>
<span>    <span class='va'>intDT</span><span class='op'>[</span>, <span class='va'>FX</span><span class='op'>:=</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"EUR/"</span>, <span class='va'>.CUR_base</span><span class='op'>)</span><span class='op'>]</span></span>
<span></span>
<span>    <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>intDT</span><span class='op'>)</span></span>
<span>  <span class='op'>}</span></span>
<span></span>
<span>  <span class='co'>### Limit data to relevant currencies</span></span>
<span>  <span class='va'>intDT</span> <span class='op'>&lt;-</span> <span class='va'>intDT</span><span class='op'>[</span><span class='va'>FX</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>.CUR</span>, <span class='va'>.CUR_base</span><span class='op'>)</span><span class='op'>]</span></span>
<span>  <span class='va'>intDT</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdatatable.gitlab.io/data.table/reference/dcast.data.table.html'>dcast</a></span><span class='op'>(</span><span class='va'>intDT</span>, <span class='va'>Date</span> <span class='op'>~</span> <span class='va'>FX</span>, value.var<span class='op'>=</span><span class='st'>"FXrate"</span><span class='op'>)</span></span>
<span></span>
<span>  <span class='va'>eval_text</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"intDT[, FXrate:="</span>,<span class='va'>.CUR</span>, <span class='st'>"/"</span>,<span class='va'>.CUR_base</span>,<span class='st'>"]"</span><span class='op'>)</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/eval.html'>eval</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/parse.html'>parse</a></span><span class='op'>(</span>text<span class='op'>=</span><span class='va'>eval_text</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='va'>intDT</span><span class='op'>[</span>, <span class='va'>FX</span><span class='op'>:=</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>.CUR_base</span>, <span class='st'>"/"</span>, <span class='va'>.CUR</span><span class='op'>)</span><span class='op'>]</span></span>
<span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>intDT</span><span class='op'>[</span>,<span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>Date</span>,<span class='va'>FX</span>,<span class='va'>FXrate</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span></span>
<span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
</details>
</div>
<h2 id="code-to-run-functions-1">Code to run functions</h2>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='https://r-datatable.com'>data.table</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='https://lubridate.tidyverse.org'>lubridate</a></span><span class='op'>)</span></span>
<span><span class='va'>str_file</span> <span class='op'>&lt;-</span> <span class='st'>"https://www.ecb.europa.eu/stats/eurofxref/eurofxref-hist.zip?c39d518d60048add50a3cccd64e06146"</span></span>
<span><span class='va'>DT</span> <span class='op'>&lt;-</span> <span class='fu'>import_ECB_FX_rates</span><span class='op'>(</span><span class='va'>str_file</span><span class='op'>)</span></span>
<span><span class='co'>#'</span></span>
<span><span class='va'>dt_USD_CAD</span> <span class='op'>&lt;-</span> <span class='fu'>get_FX_pair_from_ECB_rates</span><span class='op'>(</span>.dt <span class='op'>=</span> <span class='va'>DT</span>,</span>
<span>                                 .CUR_base<span class='op'>=</span><span class='st'>"USD"</span>, .CUR<span class='op'>=</span><span class='st'>"CAD"</span><span class='op'>)</span></span>
<span><span class='co'>#'</span></span>
<span><span class='va'>dt_EUR_CHF</span> <span class='op'>&lt;-</span> <span class='fu'>get_FX_pair_from_ECB_rates</span><span class='op'>(</span>.dt <span class='op'>=</span> <span class='va'>DT</span>,</span>
<span>                                 .start_date<span class='op'>=</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/ymd.html'>dmy</a></span><span class='op'>(</span><span class='st'>"31122020"</span><span class='op'>)</span>,</span>
<span>                                 .end_date  <span class='op'>=</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/ymd.html'>dmy</a></span><span class='op'>(</span><span class='st'>"31122021"</span><span class='op'>)</span>,</span>
<span>                                 .CUR_base<span class='op'>=</span><span class='st'>"EUR"</span>, .CUR<span class='op'>=</span><span class='st'>"CHF"</span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>dt_EUR_CHF</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>Date</span>, y<span class='op'>=</span><span class='va'>FXrate</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</details>
<p><img src="code-repository-for-publicly-available-finance-data_files/figure-html5/RunECBfunctions-1.png" width="624" /></p>
</div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<div class="article-footer">
  <p class="social_footer">
    <span class="disqus-comments">
      <i class="fas fa-comments"></i>
      &nbsp;
      <span class="disqus-comment-count" data-disqus-identifier="posts/2023-12-30-code-repository-for-publicly-available-finance-data/">Comment on this article</span>
    </span>
    <span class="article-sharing">
      Share: &nbsp;
      <a href="https://twitter.com/share?text=Code%20repository%20for%20publicly%20available%20finance%20data&amp;url=https%3A%2F%2Fwww.christoph-jaeckel.com%2Fposts%2F2023-12-30-code-repository-for-publicly-available-finance-data%2F" aria-label="share on twitter">
        <i class="fab fa-twitter" aria-hidden="true"></i>
      </a>
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.christoph-jaeckel.com%2Fposts%2F2023-12-30-code-repository-for-publicly-available-finance-data%2F&amp;title=Code%20repository%20for%20publicly%20available%20finance%20data" aria-label="share on linkedin">
        <i class="fab fa-linkedin" aria-hidden="true"></i>
      </a>
    </span>
  </p>
  <script id="dsq-count-scr" src="https://https-www-christoph-jaeckel-com.disqus.com/count.js" async></script>
  <div id="disqus_thread" class="hidden"></div>
  <script type="text/plain" cookie-consent="functionality">
var disqus_config = function () {
  this.page.url = 'https://www.christoph-jaeckel.com/posts/2023-12-30-code-repository-for-publicly-available-finance-data/';
  this.page.identifier = 'posts/2023-12-30-code-repository-for-publicly-available-finance-data/';
};
(function() {
  var d = document, s = d.createElement('script');
  s.src = 'https://https-www-christoph-jaeckel-com.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();
</script>
</div>
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="updates-and-corrections">Corrections</h3>
  <p>If you see mistakes or want to suggest changes, please <a href="https://github.com/christophj/cjaeckel.github.io/issues/new">create an issue</a> on the source repository.</p>
</div>
<!--/radix_placeholder_appendices-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!--radix_placeholder_navigation_after_body--><html><body>
<div class="distill-site-nav distill-site-footer">
<p>Copyright 2021 <a href="https://www.linkedin.com/in/christoph-j%C3%A4ckel-97401127/">Christoph
Jaeckel</a></p>
<p>Code shared on this website licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License,
v2.0</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->
</body></html>


</body>

</html>
